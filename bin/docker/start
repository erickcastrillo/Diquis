#!/bin/bash
# Docker development startup script

set -e

echo "ğŸš€ Starting Diquis Football Academy in Docker..."

# Check if .env.docker.local exists, if not copy from template
if [ ! -f .env.docker.local ]; then
    echo "ğŸ“‹ Creating .env.docker.local from template..."
    cp .env.docker .env.docker.local
    echo "âš ï¸  Please review and customize .env.docker.local before running again"
    exit 1
fi

# Check if Docker is running
if ! docker info >/dev/null 2>&1; then
    echo "âŒ Docker is not running. Please start Docker first."
    exit 1
fi

echo "ğŸ—ï¸  Building Docker images..."
docker compose build

echo "ğŸ¯ Starting all services..."
docker compose --env-file .env.docker.local up -d

echo "â³ Waiting for services to be ready..."
sleep 10

echo "ğŸ” Checking service status..."
docker compose ps

echo ""
echo "âœ… Diquis Football Academy is running!"
echo ""
echo "ğŸ“Š Available Services:"
echo "  ğŸŒ Rails App:     http://localhost:3000"
echo "  âš¡ Vite Dev:      http://localhost:5173"
echo "  ğŸ”§ Sidekiq Web:   http://localhost:4567"
echo "  ğŸ—„ï¸  PostgreSQL:   localhost:5432"
echo "  ğŸ”´ Redis:         localhost:6379"
echo ""
echo "ğŸ“‹ Useful Commands:"
echo "  ğŸ“Š View logs:     docker compose logs -f"
echo "  ğŸ”„ Restart:       docker compose restart"
echo "  ğŸ›‘ Stop:          docker compose down"
echo "  ğŸ§¹ Clean:         docker compose down -v"
echo "  ğŸ–¥ï¸  Shell:         docker compose exec web bash"
echo ""
echo "ğŸ‰ Happy coding!"