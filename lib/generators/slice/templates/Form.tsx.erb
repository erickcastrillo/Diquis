/**
 * <%= model_name.camelize %> Form Component
 * 
 * Reusable form component for creating and editing <%= model_name.humanize.pluralize.downcase %>.
 * Handles form state, validation, and submission with proper error display.
 * 
 * Features:
 * - Automatic form field generation based on model attributes
 * - Client-side form state management with Inertia.js
 * - Real-time validation error display
 * - Proper handling of different field types (text, textarea, checkbox)
 * - Loading states and disabled submit button during processing
 */

import { useForm } from '@inertiajs/react'
import { FormEventHandler } from 'react'
import { <%= model_name.camelize %>Type } from './types'

interface Props {
  <%= model_name.underscore %>: <%= model_name.camelize %>Type
  academy: {
    slug: string
    name: string
  }
  isEditing?: boolean
}

export default function Form({ <%= model_name.underscore %>, academy, isEditing = false }: Props) {
  // Initialize form with existing data or default values
  const { data, setData, post, put, processing, errors, reset } = useForm({
<% attributes.each do |attr| -%>
    <%= attr[:name] %>: <%= model_name.underscore %>.<%= attr[:name] %> || <% if attr[:type] == 'boolean' %>false<% elsif attr[:type] == 'text' || attr[:type] == 'string' %>''<% else %>''<% end %>,
<% end -%>
  })

  // Handle form submission - POST for create, PUT for update
  const submit: FormEventHandler = (e) => {
    e.preventDefault()

    if (isEditing) {
      put(`/<%= model_name.underscore.pluralize %>/${<%= model_name.underscore %>.id}`)
    } else {
      post('/<%= model_name.underscore.pluralize %>')
    }
  }

  return (
    <form onSubmit={submit} className="space-y-6">
      {/* Form Fields - Generated based on model attributes */}
<% attributes.each do |attr| -%>
      <div>
        <label htmlFor="<%= attr[:name] %>" className="block text-sm font-medium text-gray-700 mb-1">
          <%= attr[:name].humanize %>
        </label>
<% if attr[:type] == 'text' -%>
        <textarea
          id="<%= attr[:name] %>"
          name="<%= attr[:name] %>"
          value={data.<%= attr[:name] %>}
          onChange={(e) => setData('<%= attr[:name] %>', e.target.value)}
          rows={4}
          className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          placeholder="Enter <%= attr[:name].humanize.downcase %>"
        />
<% elsif attr[:type] == 'boolean' -%>
        <div className="flex items-center">
          <input
            id="<%= attr[:name] %>"
            name="<%= attr[:name] %>"
            type="checkbox"
            checked={data.<%= attr[:name] %>}
            onChange={(e) => setData('<%= attr[:name] %>', e.target.checked)}
            className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
          />
          <label htmlFor="<%= attr[:name] %>" className="ml-2 block text-sm text-gray-900">
            <%= attr[:name].humanize %>
          </label>
        </div>
<% else -%>
        <input
          id="<%= attr[:name] %>"
          name="<%= attr[:name] %>"
          type="text"
          value={data.<%= attr[:name] %>}
          onChange={(e) => setData('<%= attr[:name] %>', e.target.value)}
          className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          placeholder="Enter <%= attr[:name].humanize.downcase %>"
        />
<% end -%>
        {/* Validation Error Display */}
        {errors.<%= attr[:name] %> && (
          <p className="mt-1 text-sm text-red-600">{errors.<%= attr[:name] %>}</p>
        )}
      </div>

<% end -%>
      {/* Form Actions */}
      <div className="flex justify-end space-x-3">
        <button
          type="button"
          onClick={() => window.history.back()}
          className="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Cancel
        </button>
        <button
          type="submit"
          disabled={processing}
          className="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"
        >
          {processing ? 'Saving...' : (isEditing ? 'Update' : 'Create')} <%= model_name.humanize %>
        </button>
      </div>
    </form>
  )
}